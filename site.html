<!DOCTYPE html>
<html>

<head>

    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="site.css">

    <link href='http://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'>

    <!-- Load jQuery -->
    <script src="scripts/jquery-1.10.2.js"></script>

    <!-- Load our site functions that are complete enough to be moved out -->
    <script src="site-functions.js"></script>

    <script>

    recordSet = [];

	currentRegex = {rowID:0};

	// Interrupt service function handling scrolling

	function scrollISR() {

        var offset, lowerVisible;

		offset = $("table tr:nth-last-of-type(10)").offset();		// Get the ID of the tenth-last row in the current table
		lowerVisible = ($(window).scrollTop() + $(window).height());	// Find out the current lowest visible position in the screen
		if (offset.top <= lowerVisible){ requestOld(10, true); }	// If the tenth-last row is above that position, get more rows and tell requestOld to call renderOld when complete
	}

	function newMsgISR() {

		requestNew(50, true);						// Request up to 50 new rows and tell requestNew to call renderNew when complete

	}

/*	function sandbox() {

        $("span:first-child").each(function(){                  // For each <span> element that's the first <span> in it's cell
            var cellHTML = this.parentNode.innerHTML;
            cellHTML = cellHTML.replace(/^.*?<span class="selection">/,'__'); // Remove non-selected text from the start to the first span tag, including the tag
            while (cellHTML.match(/<span class="selection">/)){
                cellHTML = cellHTML.replace(/<\/span>.*?<span class="selection">/,'__'); // As above for each middle tag
            }
            cellHTML = cellHTML.replace(/<\/span>.*$/,'__');                  // And again for the final tag
            //console.log(this.parentNode.innerHTML);
            console.log(cellHTML);
        });
	}
*/
    
    function resizeSettingsDiv() {

	$outerdiv = $( "#settingsOuter" );
	$innerdiv = $( "#settingsInner" );

	var grow = {
	    transition : 'top 0.75s ease',
	    top : '20%'
	};

	var shrink = {
            transition : 'top 0.75s ease',
            top : '40%'
        };


	if ( $outerdiv.height() === 200) {
	    $outerdiv.height(400);
  	    $outerdiv.css(grow);
	    $innerdiv.height(352);
	} else {
	    $outerdiv.height(200);
            $outerdiv.css(shrink);
	    $innerdiv.height(152);
	}
    }

    </script>

</head>

<body style="background-color: #2e3033">

    <div style="position:fixed; top:40%; right:10px; z-index:10; height: 200px; width: 150px; overflow: hidden;" class="floatDiv" id="settingsOuter">
	<div style="background-color: #B8B881; border-top-left-radius: 10px; border-top-right-radius: 10px; z-index:11; text-align: center; padding: 3px; height: 15px">
		Settings
	</div>
	<div style="z-index:10; text-align: center; padding: 3px; height: 152px;" id="settingsInner">
		<div class="upArrowSvg" style="height: 75px" onclick="selectionCommit(1)" id="upArrow">
		</div>
		<div class="downArrowSvg" style="height: 75px" onclick="selectionCommit(-1)">
                </div>
	</div>
	<div style="background-color: #B8B881; text-align: center; padding: 3px; height: 15px; z-index:10;" onclick="resizeSettingsDiv()">
		...	
	</div>
<!--	<div style="position: fixed; background-color: #bbffff; top: 485px; right: 10px; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; z-index:12; text-align: center; padding: 3px; height: 15px; width:10px;">
	</div>
-->
    </div>

<!--    <button onclick="sandbox()">Call sandbox()</button>
    <button onclick="selectionCommit()">Call selectionCommit()</button>
-->
    <div class="blueTable" style="position:relative; top:20px; left:20px;">
        <table id="mainTable" oncontextmenu="selectionClear(); return false;">
            <tr id="title">
                <td>ID</td>
                <td style="min-width: 130px;">Datestamp</td>
                <td>Host</td>
                <td style="min-width: 150px;">Facility</td>
                <td>PID</td>
                <td>Message</td>
            </tr>
        </table>
    </div>
    <script>
        $(document).ready(function () {

	initialiseTable();

	window.setInterval(scrollISR,200);

	window.setInterval(newMsgISR,5000); // May need to be decreased if we're logging a high number of messages

        });
    </script>


</body>

</html>


